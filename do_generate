#!/bin/bash
#
# Copyright Â© 2014 Jesse 'Jeaye' Wilkerson
# See licensing in LICENSE file, or at:
#   http://www.opensource.org/licenses/MIT
#
# File: do_generate
# Author: Jesse 'Jeaye' Wilkerson

# XXX: Do not call this script directly: use `make generate`
set -o nounset

echo "$ECHO_PREFIX Generating from $REFERENCE to $TMP_MAN"
echo "  $ECHO_PREFIX Removing previous files"
rm -f $TMP_MAN/*.3
echo "  $ECHO_PREFIX Parsing documentation"
find $REFERENCE -name '*.html' -print0 | xargs -0 -n 1 -P 8 -J % \
./bin/stdman -d $TMP_MAN % > /dev/null 2>&1

echo "  $ECHO_PREFIX Removing unwanted pages"
for file in $(find $TMP_MAN -name '*.3' | grep -v "std::") ; do
  rm -f $file;
done

echo "  $ECHO_PREFIX Creating links for common typedefs"
./do_link
echo "$ECHO_PREFIX Done"
